<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å ±åƒ¹ç³»çµ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        margin: 0;
        padding: 0;
      }
      .container {
        width: 1000px;
        background: white;
        margin: 20px auto;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
      }
      h2,
      h3 {
        text-align: center;
        color: #333;
      }
      .section {
        margin: 15px 0;
        padding: 15px;
        border: 2px solid #ddd;
        border-radius: 8px;
        background: #fafafa;
      }
      .quote-result p {
        display: inline-block;
        width: 48%;
        margin: 5px 1%;
        vertical-align: top;
      }

      .form-group {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 10px;
      }
      .form-group label {
        width: 40%;
        font-weight: bold;
      }
      .form-group input {
        width: 55%;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
      .checkbox-group {
        display: flex;
        justify-content: center; /* è®“é¸é …ç½®ä¸­ */
        align-items: center;
        gap: 1px; /* å¢åŠ é¸é …é–“çš„é–“è· */
        flex-wrap: wrap; /* é¿å…è¶…éå¯¬åº¦æ™‚æ›è¡Œ */
      }
      .checkbox-group1 {
        display: flex;
        align-items: center;
        gap: 5px; /* èª¿æ•´é–“è· */
        position: relative;
      }

      #stockCodeContainer {
        visibility: hidden; /* é è¨­éš±è— */
        display: flex;
        align-items: center;
        gap: 10px;
        margin-left: 10px; /* é ç•™é–“è·ï¼Œé¿å…è¼¸å…¥æ¡†å‡ºç¾æ™‚å½±éŸ¿æ’ç‰ˆ */
        white-space: nowrap;
      }

      #stockCodeContainer.visible {
        visibility: visible; /* ç•¶é¸æ“‡ã€Œæ˜¯ã€æ™‚ï¼Œé¡¯ç¤º */
      }

      #stockCodeContainer input {
        flex-grow: 1; /* è®“è¼¸å…¥æ¡†ä½”æ“šå‰©é¤˜ç©ºé–“ */
        width: 150px; /* è¨­å®šæœ€å°å¯¬åº¦ï¼Œé¿å…éå° */
        min-width: 150px;
        padding: 5px; /* å…§éƒ¨é–“è·ï¼Œè®“æ–‡å­—ä¸æœƒå¤ªæ“  */
      }

      #competitorContainer {
        visibility: hidden; /* é è¨­éš±è— */
        display: flex;
        align-items: center;
        gap: 10px;
        margin-left: 10px; /* é ç•™é–“è·ï¼Œé¿å…è¼¸å…¥æ¡†å‡ºç¾æ™‚å½±éŸ¿æ’ç‰ˆ */
        white-space: nowrap;
      }

      #competitorContainer.visible {
        visibility: visible; /* ç•¶é¸æ“‡ã€Œæ˜¯ã€æ™‚ï¼Œé¡¯ç¤º */
      }

      #competitorContainer input {
        flex-grow: 1; /* è®“è¼¸å…¥æ¡†ä½”æ“šå‰©é¤˜ç©ºé–“ */
        width: 150px; /* è¨­å®šæœ€å°å¯¬åº¦ï¼Œé¿å…éå° */
        min-width: 150px;
        padding: 5px; /* å…§éƒ¨é–“è·ï¼Œè®“æ–‡å­—ä¸æœƒå¤ªæ“  */
      }

      .checkbox-group2 {
        display: flex;
        align-items: center;
        gap: 42px; /* èª¿æ•´é–“è· */
        position: relative;
        white-space: nowrap;
      }

      .form-group select {
        width: 55%;
        padding: 5px;
        height: 34px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 16px;
        box-sizing: border-box;
        background-color: white;
        appearance: none; /* ä¸åŒç€è¦½å™¨å…§å»ºæ¨£å¼çµ±ä¸€ï¼ˆè¦–éœ€è¦æ‰“é–‹ï¼‰ */
        -webkit-appearance: none; /* çµ¦Safari */
        -moz-appearance: none; /* çµ¦Firefox */
      }

      .buttons {
        text-align: center;
        margin-top: 20px;
      }
      .buttons button {
        padding: 10px 15px;
        border: none;
        background-color: #007bff;
        color: white;
        cursor: pointer;
        border-radius: 5px;
        margin: 5px;
        transition: background 0.3s ease-in-out;
      }
      .buttons button:hover {
        background-color: #0056b3;
      }
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>å ±åƒ¹ç³»çµ±</h2>

      <div class="section">
        <h3>ğŸ“Œ åŸºæœ¬è³‡æ–™</h3>
        <div class="form-group">
          <label>å…¬å¸åç¨±ï¼š</label>
          <input type="text" id="companyName" placeholder="è«‹è¼¸å…¥å…¬å¸åç¨±" />
        </div>
        <div class="form-group">
          <label>ä¸Šå¸‚æ«ƒï¼š</label>
          <div class="checkbox-group1">
            <input
              type="radio"
              name="listedCompany"
              value="å¦"
              id="listedNo"
              checked
            />
            <label for="listedNo">å¦</label>
            <input
              type="radio"
              name="listedCompany"
              value="æ˜¯"
              id="listedYes"
            />
            <label for="listedYes">æ˜¯</label>
            <!-- <div id="stockCodeContainer">
              <label for="stockCode"> è‚¡ç¥¨ä»£ç¢¼ï¼š</label>
              <input type="text" id="stockCode" placeholder="è«‹è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼" />
            </div> -->
          </div>
        </div>

        <div class="form-group">
          <label>ç”¢æ¥­åˆ¥ï¼š</label>
          <input type="text" id="industryType" placeholder="è«‹è¼¸å…¥è¡Œæ¥­åˆ¥" />
        </div>

        <div class="form-group">
          <label>æ˜¯å¦æœ‰ç«¶çˆ­å°æ‰‹ï¼š</label>
          <div class="checkbox-group1">
            <input
              type="radio"
              name="isCompetitor"
              value="å¦"
              id="isCompetitorNo"
              checked
              onclick="toggleCompetitorInput()"
            />
            <label for="isCompetitorNo">å¦</label>
            <input
              type="radio"
              name="isCompetitor"
              value="æ˜¯"
              id="isCompetitorYes"
              onclick="toggleCompetitorInput()"
            />
            <label for="isCompetitorYes">æ˜¯</label>
            <div id="competitorContainer">
              <label for="OtherCompetitor"> å°æ‰‹å…¬å¸ï¼š</label>
              <input
                type="text"
                id="OtherCompetitorName"
                placeholder="è«‹è¼¸å…¥å°æ‰‹å…¬å¸å"
              />
            </div>
          </div>
        </div>
      </div>
      <div class="section">
        <h3>ğŸ“Œ åœ‹è²¿æ¢ä»¶èˆ‡å‡ºå£è²»ç”¨</h3>

        <div
          class="form-group"
          style="display: flex; align-items: center; gap: 8px"
        >
          <label for="place" style="white-space: nowrap">äº¤è²¨åœ°é»ï¼š</label>
          <div style="display: flex; width: 55%">
            <select id="place" style="width: 100%; transition: width 0.2s">
              <option value="">è«‹é¸æ“‡</option>
              <option value="å°ç£">å°ç£</option>
              <option value="ä¸Šæµ·">ä¸Šæµ·</option>
              <option value="é¦™æ¸¯">é¦™æ¸¯</option>
              <option value="è¶Šå—">è¶Šå—</option>
              <option value="ç…™å°">ç…™å°</option>
              <option value="æ·±åœ³">æ·±åœ³</option>
              <option value="å»£å·">å»£å·</option>
              <option value="å°åº¦">å°åº¦</option>
              <option value="æ³°åœ‹">æ³°åœ‹</option>
              <option value="æ±äº¬">æ±äº¬</option>
              <option value="å…¶ä»–">å…¶ä»–</option>
            </select>
            <input
              type="text"
              id="customPlace"
              placeholder="è«‹è¼¸å…¥å…¶ä»–åœ°é»"
              style="
                width: 0%;
                overflow: hidden;
                border: none;
                transition: width 0.2s;
              "
            />
          </div>
        </div>

        <div class="form-group">
          <label for="shipping">é‹é€æ–¹å¼ï¼š</label>
          <select id="shipping">
            <option value="">è«‹é¸æ“‡</option>
            <option value="é™¸é‹">é™¸é‹</option>
            <option value="æµ·é‹">æµ·é‹</option>
            <option value="ç©ºé‹">ç©ºé‹</option>
            <option value="å¿«é">å¿«é</option>
          </select>
        </div>

        <div class="form-group">
          <label>åœ‹è²¿æ¢ä»¶ï¼š</label>
          <select id="condition">
            <option value="">è«‹é¸æ“‡</option>
            <option value="EXW">EXW â€“ Ex Worksï¼ˆå·¥å» äº¤è²¨æ¢ä»¶ï¼‰</option>
            <option value="FCA">FCA â€“ Free Carrierï¼ˆè²¨ç‰©äº¤é‹é€äººæ¢ä»¶ï¼‰</option>
            <option value="CPT">CPT â€“ Carriage Paid toï¼ˆé‹è²»ä»˜è¨–æ¢ä»¶ï¼‰</option>
            <option value="CIP">
              CIP â€“ Carriage and Insurance Paid Toï¼ˆé‹ä¿è²»ä»˜è¨–æ¢ä»¶ï¼‰
            </option>
            <option value="DAP">
              DAP â€“ Delivered at Placeï¼ˆç›®çš„åœ°äº¤è²¨æ¢ä»¶ï¼‰
            </option>
            <option value="DPU">
              DPU â€“ Delivered at Place Unloadedï¼ˆå¸è²¨åœ°äº¤æ˜“æ¢ä»¶ï¼‰
            </option>
            <option value="DDP">
              DDP â€“ Delivered Duty Paidï¼ˆè¼¸å…¥åœ‹ç¨…è¨–äº¤è²¨æ¢ä»¶ï¼‰
            </option>
            <option value="FAS">
              FAS â€“ Free Alongside Shipï¼ˆè¼¸å‡ºæ¸¯èˆ¹é‚Šäº¤è²¨æ¢ä»¶ï¼‰
            </option>
            <option value="FOB">
              FOB â€“ Free on Boardï¼ˆè¼¸å‡ºæ¸¯èˆ¹ä¸Šäº¤è²¨æ¢ä»¶ï¼‰
            </option>
            <option value="CFR">CFR â€“ Cost and Freightï¼ˆé‹è²»åœ¨å…§æ¢ä»¶ï¼‰</option>
            <option value="CIF">
              CIF â€“ Cost Insurance and Freightï¼ˆé‹ä¿è²»åœ¨å…§æ¢ä»¶ï¼‰
            </option>
          </select>
        </div>
        <div class="form-group">
          <label>é‹è²»ï¼š</label>
          <input type="text" id="fee" />
        </div>
        <div class="form-group">
          <label>å°ç£å ±é—œè²»ç”¨ï¼š</label>
          <input type="text" id="freight" />
        </div>
        <div class="form-group">
          <label>ç›®çš„åœ°è²»ç”¨ï¼š</label>
          <input type="text" id="taxe" />
        </div>
      </div>
      <div class="section">
        <h3>ğŸ“Œ æ–™è™Ÿè³‡è¨Š</h3>
        <div class="form-group">
          <label>æ–™è™Ÿï¼š</label>
          <input type="text" id="item" />
        </div>
        <div class="form-group">
          <label>å¹´ç”¨é‡ï¼š</label>
          <input type="text" id="year" />
        </div>
        <div class="form-group">
          <label>MOQï¼š</label>
          <input type="text" id="MOQ" />
        </div>
      </div>
      <div class="section">
        <h3>ğŸ“Œ æ¿æè³‡è¨Š</h3>
        <div class="form-group">
          <label>é¸æ“‡å°ºå¯¸ï¼š</label>
          <select id="materialSize" onchange="updateMaterialInput()">
            <option value="custom">è‡ªè¨‚å°ºå¯¸(èˆ‡ç°¡ç¸½è¨è«–)</option>
            <option value="320x320">320 x 320</option>
            <option value="640x320">640 x 320</option>
          </select>
        </div>
        <div class="form-group">
          <label>æ¿æå¯¬åº¦ï¼ˆmmï¼‰ï¼š</label>
          <input type="number" id="materialWidth" />
        </div>
        <div class="form-group">
          <label>æ¿æé•·åº¦ï¼ˆmmï¼‰ï¼š</label>
          <input type="number" id="materialHeight" />
        </div>
      </div>
      <div class="section">
        <h3>ğŸ“Œ è£åˆ‡å½¢ç‹€ & æ•¸é‡</h3>

        <div class="form-group">
          <label>å½¢ç‹€ï¼š</label>
          <div class="checkbox-group2">
            <input
              type="radio"
              name="shape"
              value="rectangle"
              id="rectangle"
              checked
              onclick="toggleShape()"
            />
            <label for="rectangle">æ–¹å½¢</label>
            <input
              type="radio"
              name="shape"
              value="irregular"
              id="irregular"
              onclick="toggleShape()"
            />
            <label for="irregular">ä¸è¦å‰‡å½¢ç‹€(éœ€ç•™é–“éš”)</label>
          </div>
        </div>

        <div id="rectInputs">
          <div class="form-group">
            <label>é•·åº¦ï¼š</label>
            <input type="number" id="length" />
          </div>
          <div class="form-group">
            <label>å¯¬åº¦ï¼š</label>
            <input type="number" id="width" />
          </div>
          <div class="form-group">
            <label>åšåº¦ï¼š</label>
            <input type="number" id="height" />
          </div>
        </div>

        <div id="irregularInputs" class="hidden">
          <div class="form-group">
            <label>é•·åº¦ï¼š</label>
            <input type="number" id="maxLength" />
          </div>
          <div class="form-group">
            <label>å¯¬åº¦ï¼š</label>
            <input type="number" id="maxWidth" />
          </div>
          <div class="form-group">
            <label>åšåº¦ï¼š</label>
            <input type="number" id="maxHeight" />
          </div>

          <div class="form-group">
            <label>ä¸Šå‚³æª”æ¡ˆï¼š</label>
            <input type="file" id="fileUpload" />
          </div>

          <div class="form-group">
            <label>åˆ€æ¨¡è²»ç”¨ï¼š</label>
            <input
              type="checkbox"
              id="knifeMoldCheck"
              onchange="toggleKnifeMoldInput()"
            />
            <input
              type="number"
              id="knifeMoldPrice"
              class="hidden"
              placeholder="è«‹è¼¸å…¥åˆ€æ¨¡è²»ç”¨"
            />
          </div>
        </div>
      </div>
      <div class="section">
        <h3>ğŸ“Œ ç‰¹æ®ŠåŠ å·¥</h3>
        <div class="checkbox-group">
          <input type="checkbox" id="sticker" value="0.4" /> æ‹‰æ‹” (+0.4/pcs)
          <input type="checkbox" id="notstick" value="40" /> è¡¨é¢ä¸é» (+40/ç‰‡)
          <input
            type="checkbox"
            id="drill"
            value="0.2"
            onchange="toggleDrillInput()"
          />
          æŒ–æ´ (+0.2/å­”)

          <!-- éš±è—çš„æ´æ•¸è¼¸å…¥æ¬„ä½ -->
          <div id="drillCountWrapper" style="display: none; margin-left: 20px">
            <label for="drillCount">è«‹è¼¸å…¥æŒ–å¹¾å€‹æ´ï¼š</label>
            <input
              type="number"
              id="drillCount"
              min="1"
              value="1"
              style="width: 60px"
            />
          </div>
        </div>
      </div>

      <div class="section">
        <h3>ğŸ“Œ èƒŒè† </h3>
        <div class="checkbox-group">
          <input type="radio" name="glueType" id="noGlue" value="0" />
          <label for="noGlue">ä¸èƒŒè† </label>
          <input type="radio" name="glueType" id="normalGlue" value="30" />
          <label for="normalGlue">æ™®é€šè†  (+30/ç‰‡)</label>
          <input type="radio" name="glueType" id="specialGlue" value="45" />
          <label for="specialGlue">æŒ‡å®šè†  (+45/ç‰‡)</label>
        </div>
      </div>

      <div class="section">
        <h3>ğŸ“Œ å ±åƒ¹è³‡è¨Š</h3>
        <div class="form-group">
          <label>è¨‚å–®æ•¸é‡ï¼š</label>
          <input type="number" id="quantity" placeholder="æ¯pcs +0.1å…ƒ" />
        </div>
        <div class="form-group">
          <label>ç‰Œåƒ¹ï¼š</label>
          <input type="number" id="unitPrice" placeholder="è«‹è¼¸å…¥ç‰Œåƒ¹" />
        </div>
        <div class="form-group">
          <label>æŠ˜æ•¸ï¼š</label>
          <input type="text" id="discount" placeholder="6æŠ˜è«‹å¡«0.6" />
        </div>
      </div>

      <div class="buttons">
        <button onclick="calculatePrice()">è¨ˆç®—åƒ¹æ ¼</button>
        <button onclick="addToTable()">ç·¨è¼¯å®Œæˆ</button>
        <button onclick="exportToExcel()">ä¸‹è¼‰ Excel å ±åƒ¹å–®</button>
      </div>

      <div class="section">
        <h3>ğŸ“Œ å…¬å¸è³‡è¨Š</h3>
        <p id="quoteDetails"></p>
      </div>

      <div class="section quote-result">
        <h3>ğŸ“Œ å ±åƒ¹çµæœ</h3>
        <p>
          <strong>1pcs åƒ¹æ ¼ï¼ˆä¸å«å‡ºå£è²»ç”¨ï¼‰ï¼š</strong>
          <span id="materialCostPerPiece1">0.0000</span> å…ƒ
        </p>
        <p>
          <strong>1pcs åƒ¹æ ¼ï¼ˆå«å‡ºå£è²»ç”¨ï¼‰ï¼š</strong>
          <span id="materialCostPerPiece">0.0000</span> å…ƒ
        </p>
        <p>
          <strong>ç¸½åƒ¹æ ¼ï¼ˆä¸å«å‡ºå£è²»ç”¨ï¼‰ï¼š</strong>
          <span id="totalPrice1">0</span> å…ƒ
        </p>
        <p>
          <strong>ç¸½åƒ¹æ ¼ï¼ˆå«å‡ºå£è²»ç”¨ï¼‰ï¼š</strong>
          <span id="totalPrice">0</span> å…ƒ
        </p>
      </div>

      <div class="section">
        <h3>ğŸ“Œ åˆ‡å‰²æ–¹å¼</h3>
        <p id="cuttingResult"></p>
      </div>
      <div class="section">
        <h3>ğŸ“Œ è¨ˆç®—èªªæ˜</h3>
        <p id="calculationExplanation"></p>
      </div>

      <div class="section">
        <h3>ğŸ“Œ å®Œæ•´å ±åƒ¹è¡¨</h3>
        <table id="quoteTable" border="1" width="100%">
          <thead>
            <tr>
              <th>åºè™Ÿ</th>
              <th>å“é …/æ•¸é‡/å°ºå¯¸</th>
              <th>å¹´ç”¨é‡</th>
              <th>MOQ</th>
              <th>ç´ æç‰Œåƒ¹</th>
              <th>æŠ˜æ•¸</th>
              <th>æŠ˜å¾Œç´ æåƒ¹</th>
              <th>ææ–™æµªè²»ç‡</th>
              <th>ç‰¹æ®ŠåŠ å·¥</th>
              <th>èƒŒè† </th>
              <th>åˆ€æ¨¡è²»ç”¨</th>
              <th>ä¸å«å‡ºå£è²»ä¹‹å–®PCSåƒ¹æ ¼</th>
              <th>å«å‡ºå£è²»ä¹‹å–®PCSåƒ¹æ ¼</th>
              <th>ä¸å«å‡ºå£è²»ä¹‹ç¸½åƒ¹</th>
              <th>å«å‡ºå£è²»ä¹‹ç¸½åƒ¹</th>
              <th>å‡ºå£è²»ç”¨å æ¯”</th>
              <th>ç‰‡æå°ºå¯¸</th>
              <th style="display: none">unitPrice</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <script>
      document.querySelectorAll('input[name="shape"]').forEach((input) => {
        input.addEventListener("change", function () {
          if (this.value === "rectangle") {
            document.getElementById("rectInputs").classList.remove("hidden");
            document.getElementById("irregularInputs").classList.add("hidden");
            document.getElementById("fileUpload").classList.add("hidden");
            document.getElementById("knifeMoldCheck").checked = false;
            document.getElementById("knifeMoldPrice").classList.add("hidden");
            document.getElementById("knifeMoldPrice").value = "";
            clearIrregularInputs();
          } else {
            document.getElementById("rectInputs").classList.add("hidden");
            document
              .getElementById("irregularInputs")
              .classList.remove("hidden");
            document.getElementById("fileUpload").classList.remove("hidden");
            clearRectangleInputs();
          }
        });
      });

      function toggleDrillInput() {
        const drillCheckbox = document.getElementById("drill");
        const drillCountWrapper = document.getElementById("drillCountWrapper");

        if (drillCheckbox.checked) {
          drillCountWrapper.style.display = "block";
        } else {
          drillCountWrapper.style.display = "none";
        }
      }

      function toggleKnifeMoldInput() {
        let knifeMoldCheck = document.getElementById("knifeMoldCheck");
        let knifeMoldPrice = document.getElementById("knifeMoldPrice");

        if (knifeMoldCheck.checked) {
          knifeMoldPrice.classList.remove("hidden");
        } else {
          knifeMoldPrice.classList.add("hidden");
          knifeMoldPrice.value = "";
        }
      }

      function clearRectangleInputs() {
        document.getElementById("length").value = "";
        document.getElementById("width").value = "";
        document.getElementById("height").value = "";
      }

      function clearIrregularInputs() {
        document.getElementById("maxLength").value = "";
        document.getElementById("maxWidth").value = "";
        document.getElementById("maxHeight").value = "";
      }

      function calculateCutting1() {
        const materialWidth =
          parseInt(document.getElementById("materialWidth").value) || 0;
        const materialHeight =
          parseInt(document.getElementById("materialHeight").value) || 0;
        let shape = document.querySelector('input[name="shape"]:checked').value;
        let bestCut = 1;

        if (shape === "rectangle") {
          let pieceWidth =
            parseFloat(document.getElementById("width").value) || 0;
          let pieceHeight =
            parseFloat(document.getElementById("length").value) || 0;
          if (pieceWidth > 0 && pieceHeight > 0) {
            bestCut = calculateCutting();
          }
        } else {
          let maxHeight =
            parseFloat(document.getElementById("maxHeight").value) || 0;
          let offset = maxHeight < 2 ? 2 : maxHeight > 10 ? 10 : maxHeight;
          let maxLength =
            (parseFloat(document.getElementById("maxLength").value) || 0) +
            offset;
          let maxWidth =
            (parseFloat(document.getElementById("maxWidth").value) || 0) +
            offset;
          if (maxLength > 1 && maxWidth > 1) {
            bestCut = calculateCutting2();
          }
        }

        return bestCut;
      }

      function calculateCutting2() {
        const materialWidth =
          parseInt(document.getElementById("materialWidth").value) || 0;
        const materialHeight =
          parseInt(document.getElementById("materialHeight").value) || 0;
        let maxHeight =
          parseFloat(document.getElementById("maxHeight").value) || 0;
        let offset = maxHeight < 2 ? 2 : maxHeight > 10 ? 10 : maxHeight;
        let pieceWidth =
          offset +
          (parseFloat(document.getElementById("maxLength").value) || 0);
        let pieceHeight =
          offset + (parseFloat(document.getElementById("maxWidth").value) || 0);

        if (pieceWidth <= 0 || pieceHeight <= 0) {
          document.getElementById("cuttingResult").innerText =
            "è«‹è¼¸å…¥æœ‰æ•ˆçš„é•·åº¦å’Œå¯¬åº¦ã€‚";
          return 0;
        }

        function getBestCut(
          materialWidth,
          materialHeight,
          pieceWidth,
          pieceHeight
        ) {
          let maxPieces = 0;
          let bestConfig = "";

          for (let i = 0; i <= Math.floor(materialHeight / pieceHeight); i++) {
            let firstCutRows = i;
            let remainingHeight = materialHeight - firstCutRows * pieceHeight;
            let firstCutColumns = Math.floor(materialWidth / pieceWidth);
            let secondCutRows = Math.floor(remainingHeight / pieceWidth);
            let secondCutColumns = Math.floor(materialWidth / pieceHeight);

            let totalPieces =
              firstCutRows * firstCutColumns + secondCutRows * secondCutColumns;
            if (totalPieces > maxPieces) {
              maxPieces = totalPieces;
              bestConfig = `å…ˆåˆ‡ ${firstCutRows} åˆ—ï¼Œæ¯åˆ— ${firstCutColumns} ç‰‡ï¼Œå‰©é¤˜é«˜åº¦å†åˆ‡ ${secondCutRows} åˆ—ï¼Œæ¯åˆ— ${secondCutColumns} ç‰‡ã€‚`;
            }
          }
          return { maxPieces, bestConfig };
        }

        let result1 = getBestCut(
          materialWidth,
          materialHeight,
          pieceWidth,
          pieceHeight
        );
        let result2 = getBestCut(
          materialHeight,
          materialWidth,
          pieceWidth,
          pieceHeight
        );
        let bestResult =
          result1.maxPieces >= result2.maxPieces ? result1 : result2;

        let totalArea = materialWidth * materialHeight;
        let usedArea = pieceWidth * pieceHeight * bestResult.maxPieces;
        let wastePercent = ((totalArea - usedArea) / totalArea) * 100;
        let wastePercentRounded = wastePercent.toFixed(2); // å››æ¨äº”å…¥åˆ°å°æ•¸é»å¾Œå…©ä½

        let normalRows = Math.floor(materialHeight / pieceHeight);
        let normalColumns = Math.floor(materialWidth / pieceWidth);
        let normalPieces = normalRows * normalColumns;
        let normalConfig = `æ¯å¼µæ¿æåˆ‡æˆ ${normalRows} åˆ—ã€æ¯åˆ— ${normalColumns} pcsï¼Œç¸½å…± ${normalPieces} pcsï¼ˆä¸è½‰å‘ï¼‰ã€‚`;
        let usedAreaNormal = pieceWidth * pieceHeight * normalPieces;
        let wastePercentNormal =
          ((totalArea - usedAreaNormal) / totalArea) * 100;
        let wastePercentNormalRounded = wastePercentNormal.toFixed(2);

        console.log("ğŸ“ æ¸¬è©¦åƒæ•¸å°å‡ºï¼š");
        console.log("materialHeight:", materialHeight);
        console.log("materialWidth:", materialWidth);
        console.log("pieceHeight:", pieceHeight);
        console.log("pieceWidth:", pieceWidth);
        console.log("normalRows:", normalRows);
        console.log("normalColumns:", normalColumns);
        console.log("normalPieces:", normalPieces);
        console.log("normalConfig:", normalConfig);

        let isIrregular = document.getElementById("irregular").checked;
        if (isIrregular) {
          maxHeight =
            parseFloat(document.getElementById("maxHeight").value) || 0;
          let offset = maxHeight < 2 ? 2 : maxHeight > 10 ? 10 : maxHeight;
          document.getElementById("cuttingResult").innerText = `
            ä¸è¦å‰‡å½¢ç‹€é–“éš” ${offset}mmã€‚
            æ™®é€šåˆ‡å‰²æ–¹å¼ï¼ˆä¸è½‰å‘ï¼‰ï¼šæ¯å¼µæ¿æå¯åˆ‡ ${normalPieces} pcsã€‚
            åˆ‡å‰²æ–¹æ¡ˆï¼š${normalConfig}
            æ™®é€šåˆ‡å‰²ææ–™æµªè²»ï¼š${wastePercentNormalRounded}%\n
            æœ€ä½³åˆ‡å‰²æ–¹å¼ï¼šæ¯å¼µæ¿æå¯åˆ‡ ${bestResult.maxPieces} pcsã€‚
            åˆ‡å‰²æ–¹æ¡ˆï¼š${bestResult.bestConfig}\n
            æœ€ä½³åˆ‡å‰²ææ–™æµªè²»ï¼š${wastePercentRounded}%`;
        } else {
          document.getElementById("cuttingResult").innerText = `
            æ™®é€šåˆ‡å‰²æ–¹å¼ï¼ˆä¸è½‰å‘ï¼‰ï¼šæ¯å¼µæ¿æå¯åˆ‡ ${normalPieces} pcsã€‚
            åˆ‡å‰²æ–¹æ¡ˆï¼š${normalConfig}
            æ™®é€šåˆ‡å‰²ææ–™æµªè²»ï¼š${wastePercentNormalRounded}%\n
            æœ€ä½³åˆ‡å‰²æ–¹å¼ï¼šæ¯å¼µæ¿æå¯åˆ‡ ${bestResult.maxPieces} pcsã€‚
            åˆ‡å‰²æ–¹æ¡ˆï¼š${bestResult.bestConfig}\n
            æœ€ä½³åˆ‡å‰²ææ–™æµªè²»ï¼š${wastePercentRounded}%`;
        }
        window.wastePercentNormalRounded = wastePercentNormalRounded;

        return bestResult.maxPieces;
      }

      function calculateCutting() {
        if (!checkFileUpload()) return;
        const materialWidth =
          parseInt(document.getElementById("materialWidth").value) || 0;
        const materialHeight =
          parseInt(document.getElementById("materialHeight").value) || 0;
        let pieceWidth =
          parseFloat(document.getElementById("width").value) || 0;
        let pieceHeight =
          parseFloat(document.getElementById("length").value) || 0;

        if (pieceWidth <= 0 || pieceHeight <= 0) {
          document.getElementById("cuttingResult").innerText =
            "è«‹è¼¸å…¥æœ‰æ•ˆçš„é•·åº¦å’Œå¯¬åº¦ã€‚";
          return 0;
        }
        if (pieceWidth > pieceHeight) {
          let temp = pieceWidth;
          pieceWidth = pieceHeight;
          pieceHeight = temp;
        }

        function getBestCut(
          materialWidth,
          materialHeight,
          pieceWidth,
          pieceHeight
        ) {
          let maxPieces = 0;
          let bestConfig = "";

          for (let i = 0; i <= Math.floor(materialHeight / pieceHeight); i++) {
            let firstCutRows = i;
            let remainingHeight = materialHeight - firstCutRows * pieceHeight;
            let firstCutColumns = Math.floor(materialWidth / pieceWidth);
            let secondCutRows = Math.floor(remainingHeight / pieceWidth);
            let secondCutColumns = Math.floor(materialWidth / pieceHeight);

            let totalPieces =
              firstCutRows * firstCutColumns + secondCutRows * secondCutColumns;
            if (totalPieces > maxPieces) {
              maxPieces = totalPieces;
              bestConfig = `å…ˆåˆ‡ ${firstCutRows} åˆ—ï¼Œæ¯åˆ— ${firstCutColumns} ç‰‡ï¼Œå‰©é¤˜é«˜åº¦å†åˆ‡ ${secondCutRows} åˆ—ï¼Œæ¯åˆ— ${secondCutColumns} ç‰‡ã€‚`;
            }
          }
          return { maxPieces, bestConfig };
        }

        let result1 = getBestCut(
          materialWidth,
          materialHeight,
          pieceWidth,
          pieceHeight
        );
        let result2 = getBestCut(
          materialHeight,
          materialWidth,
          pieceWidth,
          pieceHeight
        );
        let bestResult =
          result1.maxPieces >= result2.maxPieces ? result1 : result2;

        let totalArea = materialWidth * materialHeight;
        let usedArea = pieceWidth * pieceHeight * bestResult.maxPieces;
        let wastePercent = ((totalArea - usedArea) / totalArea) * 100;
        let wastePercentRounded = wastePercent.toFixed(2); // å››æ¨äº”å…¥åˆ°å°æ•¸é»å¾Œå…©ä½

        // let normalRows = Math.floor(materialHeight / pieceHeight);
        // let normalColumns = Math.floor(materialWidth / pieceWidth);
        // let normalPieces = normalRows * normalColumns;

        // â¤ æ¨¡æ“¬å…©ç¨®æ’æ³•ï¼ˆç›´å¼ or æ©«å¼ï¼‰
        function getNormalCutPieces(mw, mh, pw, ph) {
          let rows = Math.floor(mh / ph);
          let cols = Math.floor(mw / pw);
          return { pieces: rows * cols, rows, cols };
        }

        // â¤ ç¬¬ä¸€ç¨®ï¼šç”¨åŸæ–¹å‘åˆ‡
        let cutA = getNormalCutPieces(
          materialWidth,
          materialHeight,
          pieceWidth,
          pieceHeight
        );

        // â¤ ç¬¬äºŒç¨®ï¼šæ—‹è½‰90åº¦åˆ‡
        let cutB = getNormalCutPieces(
          materialWidth,
          materialHeight,
          pieceHeight,
          pieceWidth
        );

        // â¤ æ¯”è¼ƒå“ªä¸€ç¨®åˆ‡å‡ºæ›´å¤š
        let normalRows, normalColumns, normalPieces;
        if (cutA.pieces >= cutB.pieces) {
          normalRows = cutA.rows;
          normalColumns = cutA.cols;
          normalPieces = cutA.pieces;
        } else {
          normalRows = cutB.rows;
          normalColumns = cutB.cols;
          normalPieces = cutB.pieces;
        }
        let normalConfig = `æ¯å¼µç‰‡æåˆ‡æˆ ${normalRows} åˆ—ã€æ¯åˆ— ${normalColumns} pcsï¼Œç¸½å…± ${normalPieces} pcsï¼ˆä¸è½‰å‘ï¼‰ã€‚`;
        let usedAreaNormal = pieceWidth * pieceHeight * normalPieces;
        let wastePercentNormal =
          ((totalArea - usedAreaNormal) / totalArea) * 100;
        let wastePercentNormalRounded = wastePercentNormal.toFixed(2);

        console.log("ğŸ“ æ¸¬è©¦åƒæ•¸å°å‡ºï¼š");
        console.log("materialHeight:", materialHeight);
        console.log("materialWidth:", materialWidth);
        console.log("pieceHeight:", pieceHeight);
        console.log("pieceWidth:", pieceWidth);
        console.log("normalRows:", normalRows);
        console.log("normalColumns:", normalColumns);
        console.log("normalPieces:", normalPieces);
        console.log("normalConfig:", normalConfig);

        let isIrregular = document.getElementById("irregular").checked;
        if (isIrregular) {
          maxHeight =
            parseFloat(document.getElementById("maxHeight").value) || 0;
          let offset = maxHeight < 2 ? 2 : maxHeight > 10 ? 10 : maxHeight;
          document.getElementById("cuttingResult").innerText = `
            ä¸è¦å‰‡å½¢ç‹€é–“éš” ${offset}mmã€‚
            æ™®é€šåˆ‡å‰²æ–¹å¼ï¼ˆä¸è½‰å‘ï¼‰ï¼šæ¯å¼µæ¿æå¯åˆ‡ ${normalPieces} pcsã€‚
            åˆ‡å‰²æ–¹æ¡ˆï¼š${normalConfig}
            æ™®é€šåˆ‡å‰²ææ–™æµªè²»ï¼š${wastePercentNormalRounded}%\n
            æœ€ä½³åˆ‡å‰²æ–¹å¼ï¼šæ¯å¼µæ¿æå¯åˆ‡ ${bestResult.maxPieces} pcsã€‚
            åˆ‡å‰²æ–¹æ¡ˆï¼š${bestResult.bestConfig}\n
            æœ€ä½³åˆ‡å‰²ææ–™æµªè²»ï¼š${wastePercentRounded}%`;
        } else {
          document.getElementById("cuttingResult").innerText = `
            æ™®é€šåˆ‡å‰²æ–¹å¼ï¼ˆä¸è½‰å‘ï¼‰ï¼šæ¯å¼µæ¿æå¯åˆ‡ ${normalPieces} pcsã€‚
            åˆ‡å‰²æ–¹æ¡ˆï¼š${normalConfig}
            æ™®é€šåˆ‡å‰²ææ–™æµªè²»ï¼š${wastePercentNormalRounded}%\n
            æœ€ä½³åˆ‡å‰²æ–¹å¼ï¼šæ¯å¼µæ¿æå¯åˆ‡ ${bestResult.maxPieces} pcsã€‚
            åˆ‡å‰²æ–¹æ¡ˆï¼š${bestResult.bestConfig}\n
            æœ€ä½³åˆ‡å‰²ææ–™æµªè²»ï¼š${wastePercentRounded}%`;
        }
        window.wastePercentNormalRounded = wastePercentNormalRounded;

        return bestResult.maxPieces;
      }

      function calculatePrice() {
        if (!checkFileUpload()) return;

        // === 1. åŸºæœ¬è³‡æ–™ ===
        let unitPrice =
          parseFloat(document.getElementById("unitPrice").value) || 0; // å–®åƒ¹
        let freight = parseFloat(document.getElementById("freight").value) || 0; // é‹è²»
        let fee = parseFloat(document.getElementById("fee").value) || 0; // å…¶ä»–è²»ç”¨
        let taxe = parseFloat(document.getElementById("taxe").value) || 0; // ç¨…é‡‘
        let quantity = parseInt(document.getElementById("quantity").value) || 0; // å°ç‰‡æ•¸é‡ï¼ˆé¡§å®¢è¦å¹¾ç‰‡ï¼‰

        let bestCut = calculateCutting1(); // ä¸€å¤§ç‰‡å¯ä»¥åˆ‡å¹¾å°ç‰‡
        if (bestCut === 0) return;
        let materialWidth =
          parseInt(document.getElementById("materialWidth").value) || 0;
        let materialHeight =
          parseInt(document.getElementById("materialHeight").value) || 0;
        let pieceWidth, pieceHeight, maxHeight;
        let isIrregular = document.getElementById("irregular").checked;

        if (isIrregular) {
          pieceWidth =
            parseFloat(document.getElementById("maxWidth").value) || 0;
          pieceHeight =
            parseFloat(document.getElementById("maxLength").value) || 0;
          maxHeight =
            parseFloat(document.getElementById("maxHeight").value) || 0;
          let offset = maxHeight < 2 ? 2 : maxHeight > 10 ? 10 : maxHeight;
          pieceWidth += offset;
          pieceHeight += offset;
        } else {
          pieceWidth = parseFloat(document.getElementById("width").value) || 0;
          pieceHeight =
            parseFloat(document.getElementById("length").value) || 0;
        }
        // â¤ æ¨¡æ“¬å…©ç¨®æ’æ³•ï¼ˆç›´å¼ or æ©«å¼ï¼‰
        function getNormalCutPieces(mw, mh, pw, ph) {
          let rows = Math.floor(mh / ph);
          let cols = Math.floor(mw / pw);
          return { pieces: rows * cols, rows, cols };
        }

        // â¤ ç¬¬ä¸€ç¨®ï¼šç”¨åŸæ–¹å‘åˆ‡
        let cutA = getNormalCutPieces(
          materialWidth,
          materialHeight,
          pieceWidth,
          pieceHeight
        );

        // â¤ ç¬¬äºŒç¨®ï¼šæ—‹è½‰90åº¦åˆ‡
        let cutB = getNormalCutPieces(
          materialWidth,
          materialHeight,
          pieceHeight,
          pieceWidth
        );

        // â¤ æ¯”è¼ƒå“ªä¸€ç¨®åˆ‡å‡ºæ›´å¤š
        let normalRows, normalColumns, normalPieces;
        if (cutA.pieces >= cutB.pieces) {
          normalRows = cutA.rows;
          normalColumns = cutA.cols;
          normalPieces = cutA.pieces;
        } else {
          normalRows = cutB.rows;
          normalColumns = cutB.cols;
          normalPieces = cutB.pieces;
        }

        let bigSheetQuantity = Math.ceil(quantity / normalPieces); // éœ€è¦çš„å¤§ç‰‡æ•¸é‡
        let bigSheetQuantitypoint =
          Math.round((quantity / normalPieces) * 100) / 100;
        let smallPieceQuantity = quantity; // å°ç‰‡æ•¸é‡

        // === 2. åŠ ä¸Šè¡¨é¢ä¸é»/èƒŒè† è²»ï¼ˆæ¯å¤§ç‰‡ï¼‰===
        let normalGlueChecked = document.getElementById("normalGlue").checked;
        let specialGlueChecked = document.getElementById("specialGlue").checked;
        let glueCost = 0;
        if (normalGlueChecked && specialGlueChecked) {
          alert("åªèƒ½é¸æ“‡ä¸€ç¨®èƒŒè† ï¼");
          return;
        }
        if (normalGlueChecked) glueCost = 30;
        if (specialGlueChecked) glueCost = 45;

        let notstickCost = document.getElementById("notstick").checked ? 40 : 0;

        // æ¯ä¸€å¤§ç‰‡åŸºæœ¬åƒ¹æ ¼
        let singleBigSheetPrice = unitPrice + glueCost + notstickCost;

        // === 3. å°ç‰‡åŠ å·¥è²» ===
        let drillCostPerHole = 0.2;
        let drillChecked = document.getElementById("drill").checked;
        let drillCount = drillChecked
          ? parseInt(document.getElementById("drillCount").value) || 0
          : 0;

        let drillCostPerPiece = drillChecked
          ? drillCount * drillCostPerHole
          : 0;

        drillCostPerPiece = drillCostPerPiece.toFixed(1);

        let stickerCostPerPrice = document.getElementById("sticker").checked
          ? 0.4
          : 0;

        // === 4. åˆ€æ¨¡è²»ç”¨ ===
        let knifeMoldChecked =
          document.getElementById("knifeMoldCheck").checked;
        let knifeMoldCost = knifeMoldChecked
          ? parseFloat(document.getElementById("knifeMoldPrice").value) || 0
          : 0;

        // === 5. æŠ˜æ‰£ ===
        let discount =
          parseFloat(document.getElementById("discount").value) || 1;

        // === 6. ç…§ä½ çš„æ–°å…¬å¼è¨ˆç®— totalPrice ===
        let subtotalBeforeDiscount =
          singleBigSheetPrice * bigSheetQuantitypoint +
          smallPieceQuantity * drillCostPerPiece +
          smallPieceQuantity * stickerCostPerPrice;
        let subtotalAfterDiscount = subtotalBeforeDiscount * discount;
        let totalPrice1 = subtotalAfterDiscount + quantity * 0.1; // ä¸å«å‡ºå£è²»ä¹‹å–®PCSåƒ¹æ ¼
        let totalPrice =
          subtotalAfterDiscount + freight + fee + taxe + quantity * 0.1; // å«å‡ºå£è²»ä¹‹ç¸½åƒ¹

        // === 7. å–®ç‰‡åƒ¹æ ¼ ===
        let materialCostPerPiece = totalPrice / smallPieceQuantity; // å«å‡ºå£è²»ä¹‹å–®pcsåƒ¹æ ¼
        let materialCostPerPiece1 = totalPrice1 / smallPieceQuantity; // ä¸å«å‡ºå£è²»ä¹‹å–®pcsåƒ¹æ ¼

        document.getElementById("totalPrice").innerText =
          Math.round(totalPrice).toString();

        document.getElementById("totalPrice1").innerText =
          Math.round(totalPrice1).toString();

        document.getElementById("materialCostPerPiece").innerText =
          materialCostPerPiece.toFixed(4);

        document.getElementById("materialCostPerPiece1").innerText =
          materialCostPerPiece1.toFixed(4);

        // **å–å¾—åŸºæœ¬è³‡æ–™**
        const companyName = document.getElementById("companyName").value;
        const industryType = document.getElementById("industryType").value;
        const isCompetitor = document.querySelector(
          'input[name="isCompetitor"]:checked'
        ).value;
        const competitorName = document.getElementById(
          "OtherCompetitorName"
        ).value;
        const listedStatus = document.querySelector(
          'input[name="listedCompany"]:checked'
        ).value;

        const place = document.getElementById("place").value;
        const customPlace = document.getElementById("customPlace").value;
        const finalPlace =
          place === "å…¶ä»–" && customPlace.trim() !== "" ? customPlace : place;

        const shipping = document.getElementById("shipping").value;
        const condition = document.getElementById("condition").value;

        const quoteDetailsDiv = document.getElementById("quoteDetails");
        if (quoteDetailsDiv) {
          quoteDetailsDiv.innerHTML = `
            <div style="display: flex; flex-wrap: wrap; gap: 20px;">
              <div style="flex: 1; min-width: 200px;">
                <p><strong>å…¬å¸åç¨±ï¼š</strong> ${companyName}</p>
                <p><strong>ä¸Šå¸‚æ«ƒï¼š</strong> ${listedStatus}</p>
                <p><strong>è¡Œæ¥­åˆ¥ï¼š</strong> ${industryType}</p>
                <p><strong>æ˜¯å¦æœ‰ç«¶çˆ­å°æ‰‹ï¼š</strong> ${isCompetitor}</p>
              </div>
              <div style="flex: 1; min-width: 200px;">
                ${
                  isCompetitor === "æ˜¯"
                    ? `<p><strong>å°æ‰‹å…¬å¸ï¼š</strong> ${competitorName}</p>`
                    : ""
                }
                <p><strong>äº¤è²¨åœ°é»ï¼š</strong> ${finalPlace}</p>
                <p><strong>é‹é€æ–¹å¼ï¼š</strong> ${shipping}</p>
                <p><strong>åœ‹è²¿æ¢ä»¶ï¼š</strong> ${condition}</p>
              </div>
            </div>
          `;
        } else {
          console.error("âŒ ç„¡æ³•æ‰¾åˆ° #quoteDetailsï¼Œè«‹ç¢ºèª HTML çµæ§‹ï¼");
        }

        // === 10. é¡¯ç¤ºè¨ˆç®—å…¬å¼èªªæ˜ ===
        let calculationExplanationDiv = document.getElementById(
          "calculationExplanation"
        );

        if (calculationExplanationDiv) {
          calculationExplanationDiv.innerHTML = `

        <p><strong>ç‰‡æä½¿ç”¨æ•¸é‡ï¼š</strong> ${quantity} / ${normalPieces} = ${bigSheetQuantitypoint}
        <p><strong>ä¸å«å‡ºå£è²»ç”¨ä¹‹å–®pcsåƒ¹æ ¼ï¼š</strong>
          {[(${unitPrice} + ${notstickCost} + ${glueCost}) Ã— ${bigSheetQuantitypoint} + (${smallPieceQuantity} Ã— ${drillCount} Ã— ${drillCostPerHole}) + ( ${quantity} * 0.1 ) + (${smallPieceQuantity} Ã— ${stickerCostPerPrice})] Ã— æŠ˜æ‰£ ${discount}} / ${smallPieceQuantity}
          = <strong>${materialCostPerPiece1.toFixed(4)}</strong> å…ƒ
        </p>

        <p><strong>å«å‡ºå£è²»ç”¨ä¹‹å–®pcsåƒ¹æ ¼ï¼š</strong>
          {[(${unitPrice} + ${notstickCost} + ${glueCost}) Ã— ${bigSheetQuantitypoint} + (${smallPieceQuantity} Ã— ${drillCount} Ã— ${drillCostPerHole}) + ( ${quantity} * 0.1 ) + (${smallPieceQuantity} Ã— ${stickerCostPerPrice})] Ã— æŠ˜æ‰£ ${discount} + å‡ºå£è²» ${fee} + å ±é—œè²» ${freight} + ç›®çš„åœ°è²» ${taxe}} / ${smallPieceQuantity}
          = <strong>${materialCostPerPiece.toFixed(4)}</strong> å…ƒ
        </p>

        <p><strong>ä¸å«å‡ºå£è²»ç”¨ä¹‹ç¸½åƒ¹ï¼š</strong>
          [(${unitPrice} + ${notstickCost} + ${glueCost}) Ã— ${bigSheetQuantitypoint} + (${smallPieceQuantity} Ã— ${drillCount} Ã— ${drillCostPerHole}) + ( ${quantity} * 0.1 ) + (${smallPieceQuantity} Ã— ${stickerCostPerPrice})] Ã— æŠ˜æ‰£ ${discount}
          = <strong>${Math.round(totalPrice1)}</strong> å…ƒ
        </p>

        <p><strong>å«å‡ºå£è²»ç”¨ä¹‹ç¸½åƒ¹ï¼š</strong>
          [(${unitPrice} + ${notstickCost} + ${glueCost}) Ã— ${bigSheetQuantitypoint} + (${smallPieceQuantity} Ã— ${drillCount} Ã— ${drillCostPerHole}) + ( ${quantity} * 0.1 ) + (${smallPieceQuantity} Ã— ${stickerCostPerPrice})] Ã— æŠ˜æ‰£ ${discount} + å‡ºå£è²» ${fee} + å ±é—œè²» ${freight} + ç›®çš„åœ°è²» ${taxe}
          = <strong>${Math.round(totalPrice)}</strong> å…ƒ
        </p>
      `;
        } else {
          console.error(
            "âŒ ç„¡æ³•æ‰¾åˆ° #calculationExplanationï¼Œè«‹ç¢ºèª HTML çµæ§‹ï¼"
          );
        }
        updateShippingFeeAndUnitCost();
      }

      function toggleOtherInput() {
        let otherCheckbox = document.getElementById("other");
        let otherTextInput = document.getElementById("otherText");
        if (otherCheckbox.checked) {
          otherTextInput.classList.remove("hidden");
        } else {
          otherTextInput.classList.add("hidden");
          otherTextInput.value = "";
        }
      }

      function checkFileUpload() {
        let shape = document.querySelector('input[name="shape"]:checked').value;
        let fileInput = document.getElementById("fileUpload");
        if (shape === "irregular" && fileInput.files.length === 0) {
          alert("è«‹ä¸Šå‚³ä¸è¦å‰‡å½¢ç‹€çš„æª”æ¡ˆä»¥åŠç¢ºèªåˆ€æ¨¡è²»ç”¨ï¼");
          return false;
        }
        return true;
      }
      let rowIndex = 1; // åˆå§‹åºè™Ÿ

      function addToTable() {
        let table = document
          .getElementById("quoteTable")
          .getElementsByTagName("tbody")[0];

        // ========== æ–™è™Ÿè³‡è¨Š ==========
        let item = document.getElementById("item").value || "æœªå¡«å¯«";
        let yearUsage = document.getElementById("year").value || "0";
        let moq = document.getElementById("MOQ").value || "æœªå¡«å¯«";
        let discount = document.getElementById("discount").value || "1";
        let pcsPrice =
          document.getElementById("materialCostPerPiece").innerText || "0";
        let pcsPrice1 =
          document.getElementById("materialCostPerPiece1").innerText || "0";
        let totalPrice = document.getElementById("totalPrice").innerText || "0";
        let totalPrice1 =
          document.getElementById("totalPrice1").innerText || "0";
        // let totalPrice = document.getElementById("totalPrice").innerText; // document.getElementById("totalPrice").innerText || "0";
        let unitPrice = document.getElementById("unitPrice").value || "0";

        // ========== é‹è²»è³‡è¨Š ==========
        // let freight = document.getElementById("freight").value || "0";
        // // let fee = document.getElementById("fee").value || "0";
        // let taxe = document.getElementById("taxe").value || "0";
        let quantity = document.getElementById("quantity").value || "0";
        // ========== å°ºå¯¸è™•ç† ==========
        let shape = document.querySelector('input[name="shape"]:checked').value;
        let sizeText = "";
        if (shape === "rectangle") {
          let length = document.getElementById("length").value || "æœªå¡«å¯«";
          let width = document.getElementById("width").value || "æœªå¡«å¯«";
          let thickness = document.getElementById("height").value || "æœªå¡«å¯«";
          sizeText = `${length} x ${width} x ${thickness}`;
        } else {
          let maxLength =
            document.getElementById("maxLength").value || "æœªå¡«å¯«";
          let maxWidth = document.getElementById("maxWidth").value || "æœªå¡«å¯«";
          let maxHeight =
            document.getElementById("maxHeight").value || "æœªå¡«å¯«";
          sizeText = `${maxLength} x ${maxWidth} x ${maxHeight} (ä¸è¦å‰‡)`;
        }
        // ========== æ¿æå°ºå¯¸ ==========
        let materialWidth =
          document.getElementById("materialWidth").value || "æœªå¡«å¯«";
        let materialHeight =
          document.getElementById("materialHeight").value || "æœªå¡«å¯«";
        let materialSizeText = `${materialWidth} x ${materialHeight}`;

        // ========== ç‰¹æ®ŠåŠ å·¥ ==========
        let specialProcessing = [];

        if (document.getElementById("sticker").checked)
          specialProcessing.push("æ‹‰æ‹” (+0.4/pcs)");
        if (document.getElementById("notstick").checked)
          specialProcessing.push("è¡¨é¢ä¸é» (+40/ç‰‡)");
        if (document.getElementById("drill").checked) {
          const drillCount =
            parseInt(document.getElementById("drillCount").value) || 0;
          specialProcessing.push(`æŒ–æ´ (+0.2/å­”) x ${drillCount}å­”`);
        }

        // ========== è£åˆ‡è²»ç”¨ ==========
        const cuttingCost = quantity * 0.1;
        if (quantity > 0) {
          specialProcessing.push(
            `è£åˆ‡è²»ç”¨ (+0.1/pcs) x ${quantity} = ${cuttingCost.toFixed(1)}å…ƒ`
          );
        }

        // ========== åˆ€æ¨¡è²» ==========
        let knifeMoldChecked =
          document.getElementById("knifeMoldCheck").checked;
        let knifeMoldCost = 0;

        if (knifeMoldChecked) {
          knifeMoldCost =
            parseFloat(document.getElementById("knifeMoldPrice").value) || 0;
        }

        let specialText =
          specialProcessing.length > 0 ? specialProcessing.join("ã€") : "ç„¡";

        // ========== ææ–™æµªè²»ç‡ ==========
        let wastePercentNormalRounded =
          window.wastePercentNormalRounded || "0.00";
        window.wastePercentNormalRounded = wastePercentNormalRounded;

        // ========== èƒŒè†  ==========
        let glueText = "ä¸èƒŒè† ";
        if (document.getElementById("normalGlue").checked)
          glueText = "æ™®é€šè†  (+30/ç‰‡)";
        if (document.getElementById("specialGlue").checked)
          glueText = "æŒ‡å®šè†  (+45/ç‰‡)";

        // ========== æ–°å¢ä¸€è¡Œ ==========
        const table_number = document
          .getElementById("quoteTable")
          .getElementsByTagName("tbody")[0];
        let newRow = table.insertRow();
        newRow.insertCell(0).innerText = table_number.rows.length; // åºè™Ÿ
        newRow.insertCell(1).innerText = `${item} / ${quantity} / ${sizeText}`; // å“é …/æ•¸é‡/å°ºå¯¸
        newRow.insertCell(2).innerText = yearUsage; // å¹´ç”¨é‡
        newRow.insertCell(3).innerText = moq; // MOQ
        newRow.insertCell(4).innerText = unitPrice;
        newRow.insertCell(5).innerText = discount; // æŠ˜æ•¸
        newRow.insertCell(6).innerText = (unitPrice * discount).toFixed(2); // âœ… æŠ˜å¾Œç´ æåƒ¹
        newRow.insertCell(7).innerText = wastePercentNormalRounded + "%";
        newRow.insertCell(8).innerText = specialText; // ç‰¹æ®ŠåŠ å·¥
        newRow.insertCell(9).innerText = glueText; // èƒŒè† 
        newRow.insertCell(10).innerText = knifeMoldCost.toString(); // åˆ€æ¨¡è²»ç”¨
        newRow.insertCell(11).innerText = pcsPrice1; // 1pcsåƒ¹æ ¼
        newRow.insertCell(12).innerText = pcsPrice; // 1pcsåƒ¹æ ¼
        newRow.insertCell(13).innerText = totalPrice1; // ç¸½åƒ¹
        newRow.insertCell(14).innerText = totalPrice; // ç¸½åƒ¹
        newRow.insertCell(15).innerText = pcsPrice; // å‡ºå£å æ¯”ï¼ˆæš«ç”¨ï¼‰
        newRow.insertCell(16).innerText = materialSizeText; // ç‰‡æå°ºå¯¸
        let actionsCell = newRow.insertCell(17);
        actionsCell.innerHTML = `
            <button onclick="editRow(this)">ç·¨è¼¯</button>
            <button onclick="deleteRow(this)">åˆªé™¤</button>
          `;
        let unitCell = newRow.insertCell(18);
        unitCell.innerText = unitPrice;
        unitCell.style.display = "none";
        clearFormInputs();
        updateShippingFeeAndUnitCost();
      }

      function editRow(button) {
        let row = button.parentNode.parentNode; // æ‰¾åˆ°æ•´åˆ—
        let table = document
          .getElementById("quoteTable")
          .getElementsByTagName("tbody")[0]; // â† åŠ ä¸Šé€™ä¸€æ®µ

        let cells = row.getElementsByTagName("td");

        // é‚„åŸæ¿æå°ºå¯¸
        let materialSizeParts = cells[17].innerText.split("x"); // "320 x 320"
        if (materialSizeParts.length === 2) {
          let width = materialSizeParts[0].trim();
          let height = materialSizeParts[1].trim();

          // è‡ªå‹•é¸æ“‡ dropdown
          let select = document.getElementById("materialSize");
          if (width === "320" && height === "320") {
            select.value = "320x320";
          } else if (width === "640" && height === "640") {
            select.value = "640x640";
          } else {
            select.value = "custom";
          }

          // å†å‘¼å« updateMaterialInput è®“ disabled æ­£ç¢ºæ›´æ–°
          updateMaterialInput();

          // ğŸŸ¢ æœ€å¾Œæ‰è¨­å€¼ï¼ˆç¢ºä¿ custom æ¨¡å¼æ™‚æ¬„ä½æ˜¯ enabledï¼‰
          document.getElementById("materialWidth").value = width;
          document.getElementById("materialHeight").value = height;
        }

        // è®€å›è³‡æ–™å¡«åˆ°è¡¨å–®
        let itemSize = cells[1].innerText.split(" / ");
        document.getElementById("item").value = itemSize[0] || "";

        let sizeParts = itemSize[1] ? itemSize[1].split("x") : [];
        if (sizeParts.length >= 3) {
          document.getElementById("length").value = sizeParts[0].trim();
          document.getElementById("width").value = sizeParts[1].trim();
          document.getElementById("height").value = sizeParts[2].trim();
        }

        document.getElementById("year").value = cells[2].innerText || "";
        document.getElementById("MOQ").value = cells[3].innerText || "";
        document.getElementById("discount").value = cells[5].innerText || "";
        document.getElementById("materialCostPerPiece").innerText =
          cells[8].innerText || "0";
        document.getElementById("materialCostPerPiece1").value =
          cells[9].innerText || "0";
        // //document.getElementById("fee").value = cells[9].innerText || "";
        document.getElementById("totalPrice").innerText =
          cells[10].innerText || "0";
        document.getElementById("totalPrice1").value =
          cells[11].innerText || "0";
        document.getElementById("quantity").value = itemSize[1].trim(); // â† è£œä¸Šæ•¸é‡æ¬„ä½
        document.getElementById("unitPrice").value = cells[4].innerText || "0";
        // åˆ¤æ–·ç‰¹æ®ŠåŠ å·¥å‹¾é¸
        let special = cells[8].innerText;
        document.getElementById("sticker").checked = special.includes("æ‹‰æ‹”");

        const drillCheckbox = document.getElementById("drill");
        const drillCountInput = document.getElementById("drillCount");
        const drillCountWrapper = document.getElementById("drillCountWrapper");

        // â¶ å…ˆæŠŠ special è½‰æˆçœŸæ­£çš„é™£åˆ—
        const specials = Array.isArray(special)
          ? special
          : typeof special === "string"
          ? special.split(",").map((s) => s.trim())
          : Array.from(special || []); // è‹¥æ˜¯ NodeList

        // â· åˆ¤æ–·æœ‰æ²’æœ‰ã€ŒæŒ–æ´ã€
        const drillMatch = specials.find((item) => item.includes("æŒ–æ´"));

        if (drillMatch) {
          drillCheckbox.checked = true;

          // å¾å­—ä¸²æŠ“å‡ºã€Œx 3å­”ã€è£¡é¢çš„ 3
          const m = drillMatch.match(/x\s*(\d+)\s*å­”/);
          drillCountInput.value = m ? parseInt(m[1], 10) : 1;

          drillCountWrapper.style.display = "block";
        } else {
          // å–æ¶ˆä¸¦æ¸…ç†
          drillCheckbox.checked = false;
          drillCountInput.value = "";
          drillCountWrapper.style.display = "none";
        }

        document.getElementById("notstick").checked =
          special.includes("è¡¨é¢ä¸é»");

        // åˆ¤æ–·èƒŒè† å‹¾é¸
        let glue = cells[9].innerText;
        document.getElementById("normalGlue").checked = glue.includes("æ™®é€šè† ");
        document.getElementById("specialGlue").checked =
          glue.includes("æŒ‡å®šè† ");
        document.getElementById("noGlue").checked = glue.includes("ä¸èƒŒè† ");
        // åµæ¸¬æ˜¯å¦ç‚ºä¸è¦å‰‡å½¢ç‹€
        const sizeText = itemSize[2]?.trim() || ""; // ex: "10 x 20 x 3 (ä¸è¦å‰‡)"
        const isIrregular = sizeText.includes("ä¸è¦å‰‡");

        // é‚„åŸ radio
        document.getElementById("rectangle").checked = !isIrregular;
        document.getElementById("irregular").checked = isIrregular;
        toggleShape(); // é¡¯ç¤ºå°æ‡‰æ¬„ä½å€å¡Š

        if (isIrregular) {
          // è‹¥æ˜¯ä¸è¦å‰‡ï¼Œå°±é‚„åŸ maxLength/maxWidth/maxHeight
          let irregularParts = sizeText.replace(" (ä¸è¦å‰‡)", "").split("x");
          if (irregularParts.length >= 3) {
            document.getElementById("maxLength").value =
              irregularParts[0].trim();
            document.getElementById("maxWidth").value =
              irregularParts[1].trim();
            document.getElementById("maxHeight").value =
              irregularParts[2].trim();
          }

          // åˆ€æ¨¡è²»ç”¨é–‹é—œèˆ‡æ•¸å€¼ï¼ˆçœ‹ä½ æœ‰ç„¡å­˜é€²è¡¨æ ¼ï¼‰
          const knifeMoldText = cells[8].innerText; // æˆ–å…¶ä»–åœ°æ–¹
          const knifeMoldIncluded = knifeMoldText.includes("åˆ€æ¨¡");
          document.getElementById("knifeMoldCheck").checked = knifeMoldIncluded;
          toggleKnifeMoldInput(); // é¡¯ç¤ºæˆ–éš±è— input
          // åˆ€æ¨¡è²»ç”¨è™•ç†ï¼ˆç›´æ¥è®€ index 7 çš„ç´”æ•¸å­—æ¬„ï¼‰
          let knifeMoldCost = parseFloat(cells[10].innerText) || 0;
          document.getElementById("knifeMoldCheck").checked = knifeMoldCost > 0;
          document.getElementById("knifeMoldPrice").value = knifeMoldCost;
          toggleKnifeMoldInput();
        } else {
          // æ˜¯é•·æ–¹å½¢ï¼Œå°±é‚„åŸ length/width/height
          let sizeParts = sizeText.split("x");
          if (sizeParts.length >= 3) {
            document.getElementById("length").value = sizeParts[0].trim();
            document.getElementById("width").value = sizeParts[1].trim();
            document.getElementById("height").value = sizeParts[2].trim();
          }
        }
        // ç·¨è¼¯å¾Œåˆªé™¤é€™ä¸€åˆ—ï¼Œè®“ä½¿ç”¨è€…é‡æ–°é€å‡º
        table.deleteRow(row.rowIndex - 1);
      }

      function deleteRow(button) {
        let row = button.parentNode.parentNode;
        let table = document
          .getElementById("quoteTable")
          .getElementsByTagName("tbody")[0];
        table.deleteRow(row.rowIndex - 1);
        updateShippingFeeAndUnitCost();
      }
      function toggleShape() {
        const isRectangle = document.getElementById("rectangle").checked;
        document
          .getElementById("rectInputs")
          .classList.toggle("hidden", !isRectangle);
        document
          .getElementById("irregularInputs")
          .classList.toggle("hidden", isRectangle);
      }
      function clearFormInputs() {
        document.getElementById("item").value = "";
        document.getElementById("unitPrice").value = "";
        document.getElementById("year").value = "";
        document.getElementById("discount").value = "";
        document.getElementById("MOQ").value = "";
        document.getElementById("materialCostPerPiece").innerText = "0";
        document.getElementById("totalPrice").innerText = "0";
        document.getElementById("quantity").value = "";

        // æ¸…ç©ºé•·æ–¹å½¢è¼¸å…¥
        document.getElementById("length").value = "";
        document.getElementById("width").value = "";
        document.getElementById("height").value = "";

        // æ¸…ç©ºä¸è¦å‰‡å½¢ç‹€è¼¸å…¥
        document.getElementById("maxLength").value = "";
        document.getElementById("maxWidth").value = "";
        document.getElementById("maxHeight").value = "";

        // æ¸…ç©ºä¸Šå‚³æª”æ¡ˆ
        document.getElementById("fileUpload").value = "";

        // å–æ¶ˆå‹¾é¸æ‰€æœ‰ checkbox
        document.getElementById("sticker").checked = false;
        const drillCheckbox = document.getElementById("drill");
        const drillCountInput = document.getElementById("drillCount");
        const drillCountWrapper = document.getElementById("drillCountWrapper");

        drillCheckbox.checked = false;
        drillCountInput.value = "";
        drillCountWrapper.style.display = "none";

        document.getElementById("notstick").checked = false;
        document.getElementById("normalGlue").checked = false;
        document.getElementById("specialGlue").checked = false;

        // å–æ¶ˆåˆ€æ¨¡é¸é …
        document.getElementById("knifeMoldCheck").checked = false;
        document.getElementById("knifeMoldPrice").value = "";
        document.getElementById("knifeMoldPrice").classList.add("hidden");

        // æ¢å¾©é¸æ“‡é•·æ–¹å½¢
        document.getElementById("rectangle").checked = true;
        document.getElementById("rectInputs").classList.remove("hidden");
        document.getElementById("irregularInputs").classList.add("hidden");

        // æ¸…ç©ºç›¸é—œè²»ç”¨
        // document.getElementById("taxe").value = "";
        // //document.getElementById("fee").value = "";
        // document.getElementById("freight").value = "";
      }

      function exportToExcel() {
        const table = document.getElementById("quoteTable");
        const rows = Array.from(table.rows);
        const exportData = [];

        // 1ï¸âƒ£ æ“·å–ä¸»è¡¨æ ¼è³‡æ–™ï¼ˆAï½Næ¬„ï¼‰
        rows.forEach((row) => {
          const cells = Array.from(row.cells);
          const cleanRow = cells.slice(0, 17).map((cell) => cell.innerText);
          exportData.push(cleanRow);
        });

        // 2ï¸âƒ£ æ“·å–åŸºæœ¬è³‡æ–™æ¬„ä½ï¼ˆè—è‰²å€å¡Šï¼‰
        const companyName = document.getElementById("companyName").value || "";
        const listedStatus =
          document.querySelector('input[name="listedCompany"]:checked')
            ?.value || "æœªå¡«å¯«";
        const industryType =
          document.getElementById("industryType").value || "æœªå¡«å¯«";
        const isCompetitor =
          document.querySelector('input[name="isCompetitor"]:checked')?.value ||
          "æœªå¡«å¯«";
        const competitorNames =
          document.getElementById("OtherCompetitorName").value || "ç„¡";
        const placeSelect = document.getElementById("place").value;
        const customPlace = document.getElementById("customPlace").value;
        const deliveryPlace =
          placeSelect === "å…¶ä»–" ? customPlace || "æœªå¡«å¯«" : placeSelect;
        const shipping = document.getElementById("shipping").value || "æœªé¸æ“‡";
        const condition =
          document.getElementById("condition").value || "æœªé¸æ“‡";

        // 3ï¸âƒ£ æ–°å¢è²»ç”¨æ¬„ä½
        const shippingFee = document.getElementById("fee").value || "0";
        const taiwanFee = document.getElementById("freight").value || "0";
        const destinationFee = document.getElementById("taxe").value || "0";

        // 4ï¸âƒ£ æ’å…¥ç©ºç™½åˆ—å¾Œæ–°å¢è£œå……è³‡è¨Šï¼ˆå‰é¢è£œ14æ¬„ç©ºç™½ï¼Œå°é½ŠOæ¬„èµ·ï¼‰
        const indent = Array(0).fill("");

        exportData.push([]);
        exportData.push([...indent, "â—å®¢æˆ¶ï¼š", companyName]);
        exportData.push([...indent, "â—ä¸Šå¸‚æ«ƒï¼š", listedStatus]);
        exportData.push([...indent, "â—è¡Œæ¥­åˆ¥ï¼š", industryType]);
        exportData.push([...indent, "â—æ˜¯å¦æœ‰ç«¶çˆ­å°æ‰‹ï¼š", isCompetitor]);
        if (isCompetitor === "æ˜¯") {
          exportData.push([...indent, "â—å°æ‰‹å…¬å¸ï¼š", competitorNames]);
        }
        exportData.push([...indent, "â—äº¤è²¨åœ°ï¼š", deliveryPlace]);
        exportData.push([...indent, "â—é‹é€æ–¹å¼ï¼š", shipping]);
        exportData.push([...indent, "â—åœ‹è²¿æ¢ä»¶ï¼š", condition]);
        exportData.push([]);
        exportData.push([...indent, "é‹è²»ï¼š", shippingFee]);
        exportData.push([...indent, "å°ç£å ±é—œè²»ç”¨ï¼š", taiwanFee]);
        exportData.push([...indent, "ç›®çš„åœ°è²»ç”¨ï¼š", destinationFee]);

        // 5ï¸âƒ£ åŒ¯å‡º
        const ws = XLSX.utils.aoa_to_sheet(exportData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "å ±åƒ¹å–®");
        // å»ºç«‹æ—¥æœŸå­—ä¸²ï¼ˆæ ¼å¼ï¼šYYYY-MM-DDï¼‰
        const today = new Date();
        const dateStr = today.toISOString().split("T")[0]; // ä¾‹å¦‚ï¼š2025-07-08

        // æ¸…ç†å®¢æˆ¶åç¨±ï¼ˆç§»é™¤ç©ºç™½èˆ‡éæ³•å­—å…ƒï¼‰
        const cleanCompanyName = companyName
          .trim()
          .replace(/[\\/:*?"<>|]/g, "_");

        // çµ„åˆæª”æ¡ˆåç¨±
        const filename = `å ±åƒ¹å–®-${
          cleanCompanyName || "æœªå¡«å¯«"
        }-${dateStr}.xlsx`;

        // åŒ¯å‡º Excel
        XLSX.writeFile(wb, filename);
      }

      // function exportToExcel() {
      //   const table = document.getElementById("quoteTable");
      //   const rows = Array.from(table.rows);
      //   const exportData = [];

      //   // 1ï¸âƒ£ æ“·å–ä¸»è¡¨æ ¼è³‡æ–™ï¼ˆå–å‰ 13 æ¬„ï¼‰
      //   rows.forEach((row) => {
      //     const cells = Array.from(row.cells);
      //     const cleanRow = cells.slice(0, 14).map((cell) => cell.innerText);
      //     exportData.push(cleanRow);
      //   });

      //   // 2ï¸âƒ£ æ“·å–åŸºæœ¬è³‡æ–™æ¬„ä½
      //   const companyName = document.getElementById("companyName").value || "";
      //   const listedCompany =
      //     document.querySelector('input[name="listedCompany"]:checked')
      //       ?.value || "";
      //   const industryType =
      //     document.getElementById("industryType").value || "";
      //   const isCompetitor =
      //     document.querySelector('input[name="isCompetitor"]:checked')?.value ||
      //     "";
      //   const competitorName =
      //     isCompetitor === "æ˜¯"
      //       ? document.getElementById("OtherCompetitorName").value || "ç„¡"
      //       : "";

      //   // 3ï¸âƒ£ åŸºæœ¬è³‡æ–™è¡¨é ­ + è³‡æ–™åˆ—ï¼Œå…ˆå»ºæˆå…©åˆ—
      //   const baseInfoHeader = []; // ç¬¬ 1 åˆ—ï¼ˆOæ¬„èµ·ï¼‰
      //   const baseInfoRow = []; // ç¬¬ 2 åˆ—ï¼ˆOæ¬„èµ·ï¼‰

      //   // è£œé½Šå‰14æ¬„ï¼ˆAï½Nç©ºç™½ï¼‰
      //   for (let i = 0; i < 15; i++) {
      //     baseInfoHeader.push("");
      //     baseInfoRow.push("");
      //   }

      //   // Oï½Sæ¬„è³‡æ–™
      //   baseInfoHeader.push(
      //     "å…¬å¸åç¨±",
      //     "ä¸Šå¸‚æ«ƒ",
      //     "ç”¢æ¥­åˆ¥",
      //     "æ˜¯å¦æœ‰ç«¶çˆ­å°æ‰‹",
      //     "å°æ‰‹å…¬å¸"
      //   );
      //   baseInfoRow.push(
      //     companyName,
      //     listedCompany,
      //     industryType,
      //     isCompetitor,
      //     competitorName
      //   );
      //   updateShippingFeeAndUnitCost();
      //   // æ’å…¥æœ€ä¸Šæ–¹
      //   exportData.unshift(baseInfoRow);
      //   exportData.unshift(baseInfoHeader);

      //   // 4ï¸âƒ£ åŒ¯å‡º
      //   const ws = XLSX.utils.aoa_to_sheet(exportData);
      //   const wb = XLSX.utils.book_new();
      //   XLSX.utils.book_append_sheet(wb, ws, "å ±åƒ¹å–®");
      //   XLSX.writeFile(wb, "å ±åƒ¹å–®.xlsx");
      // }

      // function updateShippingFeeAndUnitCost() {
      //   const table = document
      //     .getElementById("quoteTable")
      //     .getElementsByTagName("tbody")[0];
      //   const rows = table.getElementsByTagName("tr");

      //   let totalQuantity = 0;
      //   let freight = parseFloat(document.getElementById("freight").value) || 0;
      //   let taxe = parseFloat(document.getElementById("taxe").value) || 0;
      //   let fee = parseFloat(document.getElementById("fee").value) || 0;
      //   let shippingFee = freight + taxe + fee;

      //   // ç¬¬ä¸€æ­¥ï¼šè¨ˆç®—ç¸½æ•¸é‡
      //   for (let row of rows) {
      //     const cellText = row.cells[1].innerText; // å“é …/æ•¸é‡/å°ºå¯¸
      //     const parts = cellText.split("/");
      //     if (parts.length >= 2) {
      //       const quantity = parseInt(parts[1].trim()) || 0;
      //       totalQuantity += quantity;
      //     }
      //   }

      //   // ç¬¬äºŒæ­¥ï¼šå¹³å‡åˆ†æ”¤é‹è²»åˆ°æ¯å€‹å“é …
      //   for (let row of rows) {
      //     const unitPrice = parseFloat(row.cells[7].innerText) || 0; // åŸæœ¬çš„ 1pcsåƒ¹æ ¼
      //     const cellText = row.cells[1].innerText;
      //     const parts = cellText.split("/");
      //     const quantity =
      //       parts.length >= 2 ? parseInt(parts[1].trim()) || 0 : 0;

      //     const shippingPerPiece =
      //       totalQuantity > 0 ? shippingFee / totalQuantity : 0;
      //     const unitPriceWithShippingNum = unitPrice + shippingPerPiece;
      //     const unitPriceWithShipping = unitPriceWithShippingNum.toFixed(2); // é¡¯ç¤ºç”¨
      //     const priceWithShipping = (
      //       unitPriceWithShippingNum * quantity
      //     ).toFixed(2); // è¨ˆç®—ç”¨ + é¡¯ç¤ºç”¨
      //     const Freight_ratio =
      //       unitPriceWithShippingNum > 0
      //         ? ((shippingPerPiece / unitPriceWithShippingNum) * 100).toFixed(
      //             1
      //           ) + "%"
      //         : "0%";

      //     row.cells[8].innerText = unitPriceWithShipping; // ç¬¬9æ¬„ï¼šå–®åƒ¹(å«é‹)
      //     row.cells[10].innerText = priceWithShipping; // ç¬¬11æ¬„ï¼šç¸½åƒ¹(å«é‹)
      //     row.cells[11].innerText = Freight_ratio;
      //   }
      // }
      function updateShippingFeeAndUnitCost() {
        const table = document
          .getElementById("quoteTable")
          .getElementsByTagName("tbody")[0];
        const rows = table.getElementsByTagName("tr");

        // 1. å–å¾—å‡ºå£è²»ç”¨ç¸½å’Œ
        const freight =
          parseFloat(document.getElementById("freight").value) || 0;
        const taxe = parseFloat(document.getElementById("taxe").value) || 0;
        const fee = parseFloat(document.getElementById("fee").value) || 0;
        const shippingFee = freight + taxe + fee;

        // 2. è¨ˆç®—ç¸½æ•¸é‡
        let totalQuantity = 0;
        for (let row of rows) {
          const cellText = row.cells[1].innerText; // å“é …/æ•¸é‡/å°ºå¯¸
          const parts = cellText.split("/");
          if (parts.length >= 2) {
            const quantity = parseInt(parts[1].trim()) || 0;
            totalQuantity += quantity;
          }
        }

        // 3. å¹³å‡åˆ†æ”¤é‹è²»å¾Œæ›´æ–°æ¯ä¸€åˆ—
        for (let row of rows) {
          const unitPrice = parseFloat(row.cells[11].innerText) || 0; // åŸå§‹å–®PCSåƒ¹æ ¼ï¼ˆä¸å«é‹ï¼‰
          const cellText = row.cells[1].innerText;
          const parts = cellText.split("/");
          const quantity =
            parts.length >= 2 ? parseInt(parts[1].trim()) || 0 : 0;

          const shippingPerPiece =
            totalQuantity > 0 ? shippingFee / totalQuantity : 0;

          const unitPriceWithShippingNum = unitPrice + shippingPerPiece;
          const unitPriceWithShipping = unitPriceWithShippingNum.toFixed(4);
          const totalPrice = (unitPrice * quantity).toFixed(2);
          const totalPriceWithShipping = Math.round(
            unitPriceWithShippingNum * quantity
          );

          const Freight_ratio =
            unitPrice > 0
              ? ((shippingPerPiece / unitPrice) * 100).toFixed(1) + "%"
              : "0%";

          // æ›´æ–°æ¬„ä½
          row.cells[12].innerText = unitPriceWithShipping; // ç¬¬10æ¬„ï¼šå«é‹å–®PCSåƒ¹æ ¼
          row.cells[14].innerText = totalPriceWithShipping; // ç¬¬12æ¬„ï¼šå«é‹ç¸½åƒ¹
          row.cells[15].innerText = Freight_ratio; // ç¬¬13æ¬„ï¼šå‡ºå£è²»ç”¨å æ¯”
        }
      }

      function toggleCompetitorInput() {
        let isCompetitorYes =
          document.getElementById("isCompetitorYes").checked;
        let competitorContainer = document.getElementById(
          "competitorContainer"
        );

        if (isCompetitorYes) {
          competitorContainer.classList.add("visible");
        } else {
          competitorContainer.classList.remove("visible");
          document.getElementById("OtherCompetitorName").value = ""; // æ¸…ç©ºè¼¸å…¥æ¡†
        }
      }

      document.getElementById("place").addEventListener("change", function () {
        const place = this.value;
        const placeSelect = document.getElementById("place");
        const customPlaceInput = document.getElementById("customPlace");

        // âœ¨ã€Œå…¶ä»–ã€é¸é …æ™‚æ‹†å¯¬åº¦ä¸€åŠ
        if (place === "å…¶ä»–") {
          placeSelect.style.width = "50%";
          customPlaceInput.style.width = "50%";
          customPlaceInput.style.border = "";
        } else {
          placeSelect.style.width = "100%";
          customPlaceInput.style.width = "0";
          customPlaceInput.value = "";
          customPlaceInput.style.border = "none";
        }

        // åŸæœ¬é‚è¼¯ç…§å¸¸ä¿ç•™
        const shippingSelect = document.getElementById("shipping");
        const conditionSelect = document.getElementById("condition");
        const freightInput = document.getElementById("freight");
        const taxeInput = document.getElementById("taxe");
        const feeInput = document.getElementById("fee");

        shippingSelect.value = "";
        conditionSelect.value = "";
        freightInput.value = "";
        taxeInput.value = "";
        feeInput.value = "";

        Array.from(shippingSelect.options).forEach((option) => {
          option.hidden = false;
        });

        if (place === "å°ç£") {
          Array.from(shippingSelect.options).forEach((option) => {
            if (
              option.value &&
              option.value !== "é™¸é‹" &&
              option.value !== "ç©ºé‹"
            ) {
              option.hidden = true;
            }
          });

          conditionSelect.disabled = true;
          freightInput.disabled = true;
          taxeInput.disabled = true;
          feeInput.disabled = false;
        } else {
          conditionSelect.disabled = false;
          freightInput.disabled = false;
          taxeInput.disabled = false;
          feeInput.disabled = false;
        }
      });

      function updateMaterialInput() {
        const size = document.getElementById("materialSize").value;
        const widthInput = document.getElementById("materialWidth");
        const heightInput = document.getElementById("materialHeight");
        const unitPriceInput = document.getElementById("unitPrice");

        if (size === "320x320") {
          widthInput.value = 320;
          heightInput.value = 320;
          widthInput.disabled = true;
          heightInput.disabled = true;
          unitPriceInput.placeholder = "è«‹è¼¸å…¥ç‰Œåƒ¹";
        } else if (size === "640x320") {
          widthInput.value = 640;
          heightInput.value = 320;
          widthInput.disabled = true;
          heightInput.disabled = true;
          unitPriceInput.placeholder = "é320x320ä¹‹ç‰Œåƒ¹";
        } else {
          widthInput.value = "";
          heightInput.value = "";
          widthInput.disabled = false;
          heightInput.disabled = false;
          unitPriceInput.placeholder = "é320x320ä¹‹ç‰Œåƒ¹";
        }
      }
    </script>
  </body>
</html>
